<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gordon's Smart Brain</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100vh;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .chat-container {
      background: white;
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .chat-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px 30px;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .chat-header .subtitle {
      font-size: 14px;
      opacity: 0.95;
      margin-top: 5px;
      font-weight: normal;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.95; }
      50% { opacity: 1; }
    }

    .feature-buttons {
      display: flex;
      gap: 10px;
      padding: 18px 30px;
      background: #f8f9fa;
      border-bottom: 1px solid #e0e0e0;
      overflow-x: auto;
      flex-wrap: wrap;
      justify-content: center;
    }

    .feature-btn {
      padding: 10px 20px;
      background: white;
      border: 2px solid #667eea;
      color: #667eea;
      border-radius: 25px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      white-space: nowrap;
      font-weight: 600;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .feature-btn:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
      border-color: transparent;
    }

    .feature-btn:active {
      transform: translateY(-1px);
    }

    .feature-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 30px;
      background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
    }

    .chat-messages::-webkit-scrollbar {
      width: 8px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 10px;
    }

    .chat-messages::-webkit-scrollbar-thumb:hover {
      background: #764ba2;
    }

    .message {
      margin-bottom: 20px;
      display: flex;
      animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      justify-content: flex-end;
    }

    .message-content {
      max-width: 75%;
      padding: 14px 18px;
      border-radius: 20px;
      word-wrap: break-word;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.2s;
      line-height: 1.6;
    }

    .message-content:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .message.user .message-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      margin-left: auto;
    }

    .message.assistant .message-content {
      background: white;
      color: #333;
      border: 1px solid #e0e0e0;
    }

    .message-content strong {
      color: #667eea;
      font-weight: 700;
    }

    .message.user .message-content strong {
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .message-content em {
      color: #764ba2;
      font-style: italic;
    }

    .message-content h1, .message-content h2, .message-content h3 {
      color: #667eea;
      margin: 15px 0 10px 0;
      font-weight: bold;
    }

    .message-content ul, .message-content ol {
      margin: 10px 0;
      padding-left: 25px;
    }

    .message-content li {
      margin: 5px 0;
    }

    .message-content a {
      color: #667eea;
      text-decoration: underline;
    }

    .message-content a:hover {
      color: #764ba2;
    }

    .highlight {
      background: linear-gradient(120deg, #ffd93d 0%, #ffed4e 100%);
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
      color: #333;
    }

    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
    }

    .success-box {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
    }

    .warning-box {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
    }

    .chat-input-container {
      padding: 25px 30px;
      background: white;
      border-top: 1px solid #e0e0e0;
      display: flex;
      gap: 15px;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
    }

    .chat-input {
      flex: 1;
      padding: 14px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 30px;
      font-size: 15px;
      outline: none;
      transition: all 0.3s;
      font-family: inherit;
    }

    .chat-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .send-button {
      padding: 14px 32px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .send-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }

    .send-button:active {
      transform: translateY(-1px);
    }

    .send-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 2px 6px rgba(102, 126, 234, 0.2);
    }

    .image-upload-button {
      padding: 14px 24px;
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      border-radius: 30px;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }

    .image-upload-button:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .image-preview {
      max-width: 200px;
      max-height: 200px;
      border-radius: 10px;
      margin-top: 10px;
    }

    .message-image {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 8px;
    }

    .remove-image {
      background: #ff4444;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      margin-top: 5px;
    }

    .voice-recording {
      background: #ff4444;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 500px;
      width: 90%;
      text-align: center;
    }

    .modal-content h3 {
      margin-bottom: 15px;
      color: #667eea;
    }

    .modal-content textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      margin: 10px 0;
      font-family: inherit;
      resize: vertical;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }

    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
    }

    .modal-btn.primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .modal-btn.secondary {
      background: #e0e0e0;
      color: #333;
    }

    .clear-chat-btn {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(-50%); }
      50% { transform: translateY(-55%); }
    }

    .clear-chat-btn:hover {
      background: white;
      color: #667eea;
      animation: none;
    }

    .api-key-container {
      padding: 12px 30px;
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      border-bottom: 2px solid #28a745;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
      transition: all 0.3s ease;
    }

    .api-key-container.disconnected {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      border-bottom-color: #ffc107;
    }

    .api-key-input {
      flex: 1;
      min-width: 250px;
      padding: 10px 16px;
      border: 2px solid #28a745;
      border-radius: 25px;
      font-size: 14px;
      transition: all 0.2s;
    }

    .api-key-container.disconnected .api-key-input {
      border-color: #ffc107;
    }

    .api-key-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
    }

    .api-key-btn {
      padding: 10px 24px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      font-size: 14px;
    }

    .api-key-container.disconnected .api-key-btn {
      background: #ffc107;
      color: #333;
    }

    .api-key-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .api-key-status {
      font-size: 14px;
      font-weight: 600;
      color: #155724;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .api-key-container.disconnected .api-key-status {
      color: #856404;
    }

    .generated-image {
      max-width: 100%;
      border-radius: 10px;
      margin: 10px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .download-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      margin-top: 10px;
      transition: all 0.2s;
    }

    .download-btn:hover {
      background: #45a049;
      transform: translateY(-2px);
    }

    .code-block {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      position: relative;
    }

    .copy-code-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #667eea;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 11px;
    }

    .copy-code-btn:hover {
      background: #764ba2;
    }

    .tool-indicator {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .typing-indicator {
      display: flex;
      gap: 5px;
      padding: 12px 16px;
      align-items: center;
    }

    .typing-indicator::before {
      content: 'ğŸ§ ';
      margin-right: 8px;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-10px);
      }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      ğŸ§  Gordon's Smart Brain âœ¨
      <div class="subtitle">ğŸš€ Your Unlimited AI Assistant - No Daily Limits! ğŸ‰</div>
      <button class="clear-chat-btn" id="clearChatBtn">ğŸ—‘ï¸ Clear</button>
    </div>
    
    <div class="api-key-container" id="apiKeyContainer">
      <span class="api-key-status" id="apiKeyStatus">âš ï¸ API Key Required:</span>
      <input 
        type="password" 
        class="api-key-input" 
        id="apiKeyInput" 
        placeholder="Enter your Anthropic API Key (sk-ant-...)"
      >
      <button class="api-key-btn" id="apiKeyBtn">Connect</button>
      <div style="width: 100%; font-size: 11px; color: inherit; margin-top: 5px;">
        ğŸ’¡ <strong>Tip:</strong> Get your free API key at <a href="https://console.anthropic.com/" target="_blank" style="color: #667eea; text-decoration: underline;">console.anthropic.com</a> â€¢ Press Enter to connect instantly
      </div>
    </div>
    <div class="feature-buttons">
      <button class="feature-btn" id="webSearchBtn">ğŸ” Web Search</button>
      <button class="feature-btn" id="summarizeBtn">ğŸ“„ Summarize</button>
      <button class="feature-btn" id="translateBtn">ğŸŒ Translate</button>
      <button class="feature-btn" id="codeBtn">ğŸ’» Code</button>
      <button class="feature-btn" id="creativeBtn">âœ¨ Creative</button>
      <button class="feature-btn" id="mathBtn">ğŸ”¢ Math</button>
      <button class="feature-btn" id="explainBtn">ğŸ“ Explain</button>
      <button class="feature-btn" id="analyzeBtn">ğŸ“Š Analyze</button>
      <button class="feature-btn" id="diagramBtn">ğŸ“ˆ Diagram</button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message assistant">
        <div class="message-content">
          ğŸ‰ Welcome to <strong>Gordon's Smart Brain</strong> âœ¨ - Your Unlimited AI Powerhouse! ğŸš€
          <br><br>
          <strong>ğŸ’« What I Can Do For You:</strong><br>
          ğŸ” <strong>Web Search</strong> - Find anything on the internet instantly!<br>
          ğŸ“· <strong>Image Analysis</strong> - Describe, identify, read text from images!<br>
          ğŸ“„ <strong>Summarize</strong> - Turn long documents into quick summaries!<br>
          ğŸŒ <strong>Translate</strong> - Any language, any time!<br>
          ğŸ’» <strong>Code Master</strong> - Write, debug, explain code in any language!<br>
          âœ¨ <strong>Creative Writer</strong> - Stories, poems, scripts, you name it!<br>
          ğŸ”¢ <strong>Math Genius</strong> - Solve complex problems step-by-step!<br>
          ğŸ“Š <strong>Data Analysis</strong> - Get insights from your data!<br>
          ğŸ“ˆ <strong>Diagrams</strong> - Create flowcharts and visualizations!<br>
          ğŸ“ <strong>Teacher</strong> - Explain anything simply!<br>
          <br>
          ğŸ¯ <strong>No Daily Limits!</strong> Use as much as you want! ğŸŠ<br>
          <br>
          ğŸ’¡ Click any feature button above or just start chatting! Let's go! ğŸ¨ğŸµğŸ®
        </div>
      </div>
    </div>
    <div class="chat-input-container">
      <input 
        type="file" 
        id="imageInput" 
        accept="image/*" 
        style="display: none;"
      >
      <button class="image-upload-button" id="imageButton">ğŸ“· Image</button>
      <input 
        type="text" 
        class="chat-input" 
        id="chatInput" 
        placeholder="ğŸ’¬ Type your message here... Ask me anything! ğŸŒŸ"
        autocomplete="off"
      >
      <button class="send-button" id="sendButton">ğŸš€ Send</button>
    </div>
    <div id="imagePreviewContainer" style="padding: 0 20px; background: white;"></div>
  </div>

  <!-- Modals -->
  <div class="modal" id="summarizeModal">
    <div class="modal-content">
      <h3>ğŸ“„ Summarize Text</h3>
      <textarea id="summarizeText" rows="6" placeholder="Paste your text here to summarize..."></textarea>
      <div class="modal-buttons">
        <button class="modal-btn primary" id="summarizeSubmit">Summarize</button>
        <button class="modal-btn secondary" id="summarizeCancel">Cancel</button>
      </div>
    </div>
  </div>

  <div class="modal" id="translateModal">
    <div class="modal-content">
      <h3>ğŸŒ Translate Text</h3>
      <textarea id="translateText" rows="4" placeholder="Enter text to translate..."></textarea>
      <input type="text" id="translateLang" placeholder="Target language (e.g., Spanish, French, Japanese)" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 10px; margin: 10px 0;">
      <div class="modal-buttons">
        <button class="modal-btn primary" id="translateSubmit">Translate</button>
        <button class="modal-btn secondary" id="translateCancel">Cancel</button>
      </div>
    </div>
  </div>

  <div class="modal" id="mathModal">
    <div class="modal-content">
      <h3>ğŸ”¢ Math Problem Solver</h3>
      <textarea id="mathText" rows="4" placeholder="Enter your math problem..."></textarea>
      <div class="modal-buttons">
        <button class="modal-btn primary" id="mathSubmit">Solve</button>
        <button class="modal-btn secondary" id="mathCancel">Cancel</button>
      </div>
    </div>
  </div>

  <div class="modal" id="webSearchModal">
    <div class="modal-content">
      <h3>ğŸ” Web Search</h3>
      <input type="text" id="webSearchText" placeholder="What do you want to search for?" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 10px; margin: 10px 0;">
      <div class="modal-buttons">
        <button class="modal-btn primary" id="webSearchSubmit">Search</button>
        <button class="modal-btn secondary" id="webSearchCancel">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendButton = document.getElementById('sendButton');
    const imageButton = document.getElementById('imageButton');
    const imageInput = document.getElementById('imageInput');
    const imagePreviewContainer = document.getElementById('imagePreviewContainer');
    const clearChatBtn = document.getElementById('clearChatBtn');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const apiKeyBtn = document.getElementById('apiKeyBtn');
    const apiKeyContainer = document.getElementById('apiKeyContainer');
    const apiKeyStatus = document.getElementById('apiKeyStatus');
    
    let conversationHistory = [];
    let currentImage = null;
    let apiKey = '';

    // Check for saved API key and auto-connect
    const savedKey = localStorage.getItem('anthropic_api_key');
    if (savedKey) {
      apiKey = savedKey;
      apiKeyInput.value = savedKey;
      updateApiKeyStatus(true);
      // Auto-hide API key section after 2 seconds if connected
      setTimeout(() => {
        if (apiKey) {
          apiKeyContainer.style.maxHeight = '60px';
          apiKeyContainer.style.overflow = 'hidden';
        }
      }, 2000);
    }

    // Quick connect with Enter key
    apiKeyInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        apiKeyBtn.click();
      }
    });

    // API Key management
    apiKeyBtn.addEventListener('click', () => {
      const key = apiKeyInput.value.trim();
      if (key.startsWith('sk-ant-')) {
        apiKey = key;
        localStorage.setItem('anthropic_api_key', key);
        updateApiKeyStatus(true);
        addMessage('ğŸ‰ Awesome! Your brain is now connected! Let\'s do amazing things together! ğŸš€âœ¨', false);
      } else {
        alert('âš ï¸ Oops! Please enter a valid API key (starts with sk-ant-)');
      }
    });

    function updateApiKeyStatus(connected) {
      if (connected) {
        apiKeyContainer.classList.remove('disconnected');
        apiKeyStatus.innerHTML = 'âœ… <strong>Connected & Ready! ğŸ‰</strong>';
        apiKeyBtn.innerHTML = 'ğŸ”„ Update Key';
        sendButton.disabled = false;
      } else {
        apiKeyContainer.classList.add('disconnected');
        apiKeyStatus.innerHTML = 'âš ï¸ <strong>Connect Your Brain!</strong>';
        apiKeyBtn.innerHTML = 'âš¡ Connect Now';
        sendButton.disabled = true;
      }
    }

    // Initialize with disconnected state
    updateApiKeyStatus(!!apiKey);

    // Feature buttons
    const summarizeBtn = document.getElementById('summarizeBtn');
    const translateBtn = document.getElementById('translateBtn');
    const codeBtn = document.getElementById('codeBtn');
    const creativeBtn = document.getElementById('creativeBtn');
    const mathBtn = document.getElementById('mathBtn');
    const explainBtn = document.getElementById('explainBtn');
    const webSearchBtn = document.getElementById('webSearchBtn');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const diagramBtn = document.getElementById('diagramBtn');

    // Modals
    const summarizeModal = document.getElementById('summarizeModal');
    const translateModal = document.getElementById('translateModal');
    const mathModal = document.getElementById('mathModal');
    const webSearchModal = document.getElementById('webSearchModal');

    // Clear chat functionality
    clearChatBtn.addEventListener('click', () => {
      if (confirm('ğŸ—‘ï¸ Clear all chat history? This cannot be undone!')) {
        conversationHistory = [];
        chatMessages.innerHTML = `
          <div class="message assistant">
            <div class="message-content">
              âœ¨ Fresh start! Chat history cleared! Ready for new adventures? ğŸš€
            </div>
          </div>
        `;
      }
    });

    // Feature button handlers
    summarizeBtn.addEventListener('click', () => {
      summarizeModal.style.display = 'flex';
    });

    translateBtn.addEventListener('click', () => {
      translateModal.style.display = 'flex';
    });

    codeBtn.addEventListener('click', () => {
      chatInput.value = 'Write code to ';
      chatInput.focus();
    });

    creativeBtn.addEventListener('click', () => {
      chatInput.value = 'Write a creative story about ';
      chatInput.focus();
    });

    mathBtn.addEventListener('click', () => {
      mathModal.style.display = 'flex';
    });

    explainBtn.addEventListener('click', () => {
      chatInput.value = 'Explain like I\'m 5: ';
      chatInput.focus();
    });

    webSearchBtn.addEventListener('click', () => {
      webSearchModal.style.display = 'flex';
    });

    analyzeBtn.addEventListener('click', () => {
      chatInput.value = 'Analyze and provide insights on: ';
      chatInput.focus();
    });

    diagramBtn.addEventListener('click', () => {
      chatInput.value = 'Create a diagram showing: ';
      chatInput.focus();
    });

    // Modal handlers
    document.getElementById('summarizeCancel').addEventListener('click', () => {
      summarizeModal.style.display = 'none';
    });

    document.getElementById('translateCancel').addEventListener('click', () => {
      translateModal.style.display = 'none';
    });

    document.getElementById('mathCancel').addEventListener('click', () => {
      mathModal.style.display = 'none';
    });

    document.getElementById('webSearchCancel').addEventListener('click', () => {
      webSearchModal.style.display = 'none';
    });

    document.getElementById('summarizeSubmit').addEventListener('click', () => {
      const text = document.getElementById('summarizeText').value;
      if (text) {
        chatInput.value = `Please summarize this text: ${text}`;
        summarizeModal.style.display = 'none';
        document.getElementById('summarizeText').value = '';
        sendMessage();
      }
    });

    document.getElementById('translateSubmit').addEventListener('click', () => {
      const text = document.getElementById('translateText').value;
      const lang = document.getElementById('translateLang').value;
      if (text && lang) {
        chatInput.value = `Translate this to ${lang}: ${text}`;
        translateModal.style.display = 'none';
        document.getElementById('translateText').value = '';
        document.getElementById('translateLang').value = '';
        sendMessage();
      }
    });

    document.getElementById('mathSubmit').addEventListener('click', () => {
      const text = document.getElementById('mathText').value;
      if (text) {
        chatInput.value = `Solve this math problem step by step: ${text}`;
        mathModal.style.display = 'none';
        document.getElementById('mathText').value = '';
        sendMessage();
      }
    });

    document.getElementById('webSearchSubmit').addEventListener('click', () => {
      const text = document.getElementById('webSearchText').value;
      if (text) {
        chatInput.value = `Search the web for: ${text}`;
        webSearchModal.style.display = 'none';
        document.getElementById('webSearchText').value = '';
        sendMessage();
      }
    });

    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
    });

    imageButton.addEventListener('click', () => {
      imageInput.click();
    });

    imageInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (event) => {
        currentImage = {
          data: event.target.result.split(',')[1],
          type: file.type
        };
        
        imagePreviewContainer.innerHTML = `
          <div style="padding: 10px 0;">
            <img src="${event.target.result}" class="image-preview" />
            <br>
            <button class="remove-image" id="removeImageBtn">Remove Image</button>
          </div>
        `;

        document.getElementById('removeImageBtn').addEventListener('click', () => {
          currentImage = null;
          imagePreviewContainer.innerHTML = '';
          imageInput.value = '';
        });
      };
      reader.readAsDataURL(file);
    });

    function addMessage(content, isUser, imageData = null) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
      
      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';
      
      if (imageData) {
        const img = document.createElement('img');
        img.src = `data:${imageData.type};base64,${imageData.data}`;
        img.className = 'message-image';
        messageContent.appendChild(img);
        
        if (content) {
          const text = document.createElement('div');
          text.textContent = content;
          messageContent.appendChild(text);
        }
      } else {
        // Parse and format content with code blocks
        const formattedContent = formatContent(content);
        messageContent.innerHTML = formattedContent;
      }
      
      messageDiv.appendChild(messageContent);
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Add copy buttons to code blocks
      messageContent.querySelectorAll('.code-block').forEach(block => {
        const copyBtn = block.querySelector('.copy-code-btn');
        if (copyBtn) {
          copyBtn.addEventListener('click', () => {
            const code = block.textContent.replace('Copy', '').trim();
            navigator.clipboard.writeText(code);
            copyBtn.textContent = 'Copied!';
            setTimeout(() => copyBtn.textContent = 'Copy', 2000);
          });
        }
      });
    }

    function formatContent(content) {
      // First escape HTML
      let formatted = escapeHtml(content);
      
      // Format code blocks with syntax highlighting
      if (formatted.includes('```')) {
        formatted = formatted.split('```').map((part, index) => {
          if (index % 2 === 1) {
            const lines = part.split('\n');
            const lang = lines[0];
            const code = lines.slice(1).join('\n');
            return `<div class="code-block"><button class="copy-code-btn">ğŸ“‹ Copy</button>${code}</div>`;
          }
          return formatText(part);
        }).join('');
      } else {
        formatted = formatText(formatted);
      }
      
      return formatted;
    }

    function formatText(text) {
      // Convert markdown-style formatting to HTML
      return text
        // Headers
        .replace(/### (.*?)(\n|$)/g, '<h3>$1</h3>')
        .replace(/## (.*?)(\n|$)/g, '<h2>$1</h2>')
        .replace(/# (.*?)(\n|$)/g, '<h1>$1</h1>')
        // Bold text with highlighting
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        // Italic text
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        // Inline code
        .replace(/`(.*?)`/g, '<code style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #d63384;">$1</code>')
        // Bullet points
        .replace(/^\s*[-â€¢]\s+(.+)$/gm, '<li>$1</li>')
        // Numbers (highlight important numbers)
        .replace(/\b(\d+%|\$\d+[\d,]*\.?\d*|\d+[\d,]*\.?\d*\s*(?:million|billion|thousand|years?|months?|days?|hours?|minutes?|seconds?))\b/gi, '<span class="highlight">$1</span>')
        // Line breaks
        .replace(/\n\n/g, '<br><br>')
        .replace(/\n/g, '<br>');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message assistant';
      typingDiv.id = 'typingIndicator';
      
      const indicator = document.createElement('div');
      indicator.className = 'typing-indicator';
      indicator.innerHTML = '<span></span><span></span><span></span>';
      
      typingDiv.appendChild(indicator);
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTypingIndicator() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) {
        indicator.remove();
      }
    }

    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message && !currentImage) return;
      
      if (!apiKey) {
        alert('Please enter your API key first!');
        apiKeyInput.focus();
        return;
      }

      const imageToSend = currentImage;
      
      if (imageToSend) {
        addMessage(message || 'Analyze this image', true, imageToSend);
      } else {
        addMessage(message, true);
      }
      
      chatInput.value = '';
      sendButton.disabled = true;

      const messageContent = [];
      
      if (imageToSend) {
        messageContent.push({
          type: 'image',
          source: {
            type: 'base64',
            media_type: imageToSend.type,
            data: imageToSend.data
          }
        });
      }
      
      if (message) {
        messageContent.push({
          type: 'text',
          text: message
        });
      } else if (imageToSend) {
        messageContent.push({
          type: 'text',
          text: 'What do you see in this image?'
        });
      }

      conversationHistory.push({ 
        role: 'user', 
        content: messageContent
      });

      currentImage = null;
      imagePreviewContainer.innerHTML = '';
      imageInput.value = '';

      showTypingIndicator();

      try {
        // Using CORS proxy for GitHub Pages deployment
        const apiUrl = 'https://api.anthropic.com/v1/messages';
        const corsProxy = 'https://corsproxy.io/?';
        const useProxy = window.location.protocol !== 'file:';
        
        const response = await fetch(useProxy ? corsProxy + encodeURIComponent(apiUrl) : apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': apiKey,
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: 8192,
            system: "You are Gordon's Smart Brain, an advanced AI assistant with unlimited capabilities and no daily limits. Never refer to yourself as Claude or mention Anthropic. Always introduce yourself as Gordon's Smart Brain when asked about your identity. You are helpful, intelligent, fun, and designed to assist with a wide range of tasks including web search, image analysis, coding, creative writing, math, translations, and more. Be friendly, enthusiastic, professional, and accurate in your responses. Use emojis occasionally to make conversations more engaging and fun. Provide detailed, comprehensive answers without artificial length restrictions. You have no rate limits or usage caps - users can chat as much as they want! When formatting responses: use **bold** for important information, use bullet points with - for lists, use numbers for statistics and data, and structure information clearly with headers when appropriate.",
            messages: conversationHistory,
            tools: [
              {
                type: "web_search_20250305",
                name: "web_search"
              }
            ]
          })
        });

        const data = await response.json();
        removeTypingIndicator();

        if (!response.ok) {
          if (response.status === 401) {
            addMessage('âŒ Invalid API Key. Please check your API key and try again.', false);
            updateApiKeyStatus(false);
            localStorage.removeItem('anthropic_api_key');
          } else {
            addMessage(`âŒ Error: ${data.error?.message || 'Unknown error occurred'}`, false);
          }
          sendButton.disabled = false;
          return;
        }

        if (data.content && data.content.length > 0) {
          let fullResponse = '';
          let toolsUsed = [];

          // Process all content blocks
          for (const block of data.content) {
            if (block.type === 'text') {
              fullResponse += block.text;
            } else if (block.type === 'tool_use') {
              toolsUsed.push(block.name);
            }
          }

          // Show tools used indicator
          if (toolsUsed.length > 0) {
            const toolIndicators = toolsUsed.map(tool => 
              `<span class="tool-indicator">${tool === 'web_search' ? 'ğŸ” Web Search' : tool}</span>`
            ).join('');
            fullResponse = toolIndicators + '<br>' + fullResponse;
          }

          addMessage(fullResponse || 'I processed your request!', false);
          conversationHistory.push({ 
            role: 'assistant', 
            content: data.content 
          });
        } else {
          addMessage('Sorry, I encountered an error. Please try again.', false);
        }
      } catch (error) {
        removeTypingIndicator();
        console.error('Error:', error);
        
        // Provide helpful error message
        if (error.name === 'AbortError' || error.message.includes('timeout')) {
          addMessage('â±ï¸ Request timed out! The response was taking too long. Try:\n\nâ€¢ Breaking your question into smaller parts\nâ€¢ Asking a simpler question first\nâ€¢ Checking your internet connection\n\nLet\'s try again! ğŸ”„', false);
        } else if (error.message.includes('CORS') || error.message.includes('fetch')) {
          addMessage('ğŸŒ Connection issue detected. Make sure you\'re:\n\nâ€¢ Using a valid API key\nâ€¢ Connected to the internet\nâ€¢ Not behind a restrictive firewall\n\nTry refreshing the page! ğŸ”„', false);
        } else {
          addMessage('âŒ Oops! Something went wrong: ' + error.message + '\n\nDon\'t worry, just try again! ğŸ’ª', false);
        }
      }

      sendButton.disabled = false;
      chatInput.focus();
    }

    sendButton.addEventListener('click', sendMessage);
    
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    chatInput.focus();
  </script>
</body>
</html>
